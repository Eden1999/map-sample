(this["webpackJsonpmap-sample"]=this["webpackJsonpmap-sample"]||[]).push([[21],{428:function(e,t,r){"use strict";var i=r(2),a=r(3),n=r(5),s=r(4),l=r(0),o=(r(12),r(10)),u=(r(14),r(1)),c=r(6),h=(r(9),r(15),r(16),r(27)),f=r(88),p=r(251),d=r(144),y=r(143),m=function(e){Object(n.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).layer=null,a.parent=null,a}return Object(a.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";throw o.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(y.b)(Object(p.a)(Object(d.b)(f.a.EventedMixin(h.a)))));Object(l.a)([Object(u.b)()],m.prototype,"fullOpacity",null),Object(l.a)([Object(u.b)()],m.prototype,"layer",void 0),Object(l.a)([Object(u.b)()],m.prototype,"parent",void 0),Object(l.a)([Object(u.b)({readOnly:!0})],m.prototype,"suspended",null),Object(l.a)([Object(u.b)({readOnly:!0})],m.prototype,"suspendInfo",null),Object(l.a)([Object(u.b)({readOnly:!0})],m.prototype,"legendEnabled",null),Object(l.a)([Object(u.b)({type:Boolean,readOnly:!0})],m.prototype,"updating",null),Object(l.a)([Object(u.b)()],m.prototype,"visible",null);var b=m=Object(l.a)([Object(c.a)("esri.views.layers.LayerView")],m);t.a=b},429:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));var i,a=r(2),n=r(3),s=r(41),l=r(39),o=r(5),u=r(4),c=r(0),h=(r(12),r(10),r(14),r(1)),f=r(6),p=(r(9),r(15),r(16),r(32)),d=r(107),y=r(26),m=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return r}(r(20).a),b=m=Object(c.a)([Object(f.a)("esri.views.layers.support.ClipArea")],m),v=i=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(n.a)(r,[{key:"clone",value:function(){return new i({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(b);Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"left",void 0),Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"right",void 0),Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"top",void 0),Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"bottom",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],v.prototype,"version",null);var x,g=v=i=Object(c.a)([Object(f.a)("esri.views.layers.support.ClipRect")],v),j=r(462),w=r(83),O=r(47),k=r(92),_=r(60),T=(r(69),{base:w.a,key:"type",typeMap:{extent:O.a,polygon:k.a}}),R=x=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new x({geometry:this.geometry.clone()})}}]),r}(b);Object(c.a)([Object(h.b)({types:T,json:{read:_.a,write:!0}})],R.prototype,"geometry",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],R.prototype,"version",null);var M=R=x=Object(c.a)([Object(f.a)("esri.views.layers.support.Geometry")],R),I=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(b);Object(c.a)([Object(h.b)({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],I.prototype,"version",null);var P=I=Object(c.a)([Object(f.a)("esri.views.layers.support.Path")],I),C=p.a.ofType({key:"type",base:b,typeMap:{rect:g,path:P,geometry:M}}),S=function(e){var t=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).clips=new C,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(n.a)(r,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new j.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(y.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(y.a)(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!=(e=null==(r=t.layer)?void 0:r.opacity)?e:1)}),!0),Object(y.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(y.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,r=this.layer,i=r.minScale,a=r.maxScale;if(null!=i&&null!=a){var n=!i,s=!a;!n&&e<=i&&(n=!0),!s&&e>=a&&(s=!0),t=n&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(l.a)(r.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),r}(e);return Object(c.a)([Object(h.b)({type:C,set:function(e){var t=Object(d.b)(e,this._get("clips"),C);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(c.a)([Object(h.b)()],t.prototype,"moving",void 0),Object(c.a)([Object(h.b)()],t.prototype,"attached",void 0),Object(c.a)([Object(h.b)()],t.prototype,"container",void 0),Object(c.a)([Object(h.b)()],t.prototype,"suspended",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(c.a)([Object(h.b)()],t.prototype,"updateRequested",void 0),Object(c.a)([Object(h.b)()],t.prototype,"updating",null),Object(c.a)([Object(h.b)()],t.prototype,"view",void 0),t=Object(c.a)([Object(f.a)("esri.views.2d.layers.LayerView2D")],t)}},435:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(28),a=r(2),n=r(3),s=r(5),l=r(4),o=(r(12),r(190)),u=r(142),c=r(252),h=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e,i,n){var s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return Object(a.a)(this,r),(s=t.call(this)).triangleCountReportedInDebug=0,s.transforms={dvs:Object(c.b)(),tileMat3:Object(c.b)()},s.triangleCount=0,s.key=new u.a(e),s.bounds=i,s.size=n,s.coordRange=l,s}return Object(n.a)(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},set:function(e){this._coords=[e[0],e[3]],this._bounds=e}},{key:"setTransform",value:function(e,t){var r=t/(e.resolution*e.pixelRatio),a=this.transforms.tileMat3,n=e.toScreenNoRotation([0,0],this.coords),s=Object(i.a)(n,2),l=s[0],u=s[1],c=this.size[0]/this.coordRange[0]*r,h=this.size[1]/this.coordRange[1]*r;Object(o.i)(a,c,0,0,0,h,0,l,u,1),Object(o.f)(this.transforms.dvs,e.displayViewMat3,a)}}]),r}(r(442).a)},441:function(e,t,r){"use strict";var i=r(11),a=r(36),n=r(13),s=r(2),l=r(3),o=r(41),u=r(39),c=r(5),h=r(4),f=r(400),p=r(496),d=r(493),y=r(468),m=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},b=function(e){Object(c.a)(r,e);var t=Object(h.a)(r);function r(e){var i;return Object(s.a)(this,r),(i=t.call(this))._tileInfoView=e,i}return Object(l.a)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(m),this.setStencilReference(),Object(o.a)(Object(u.a)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state;return Object(n.a)(Object(n.a)({},Object(o.a)(Object(u.a)(r.prototype),"createRenderParams",this).call(this,e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"stencil",brushes:[d.a],drawPhase:f.c.DEBUG|f.c.MAP|f.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}}),n=e.registerRenderPass({name:"tileInfo",brushes:[p.a],drawPhase:f.c.DEBUG,target:function(){return t.children},has:"esri-tiles-debug"});return[].concat(Object(a.a)(Object(o.a)(Object(u.a)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i,n])}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,r=Object(i.a)(this.children);try{for(r.s();!(t=r.n()).done;){var a=t.value,n=this._tileInfoView.getTileResolution(a.key);a.setTransform(e,n)}}catch(s){r.e(s)}finally{r.f()}}},{key:"setStencilReference",value:function(){var e,t=1,r=Object(i.a)(this.children);try{for(r.s();!(e=r.n()).done;){e.value.stencilRef=t++}}catch(a){r.e(a)}finally{r.f()}}}]),r}(y.a);t.a=b},489:function(e,t,r){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,i=0;i<e.length;i++){var a=e[i].size;"number"==typeof a&&(t+=a,r++)}return t/r}(e.stops):t}function n(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,i=t.minSize;return(a(r,e)+a(i,e))/2})),i=0,n=r.length;if(0===n)return e;for(var s=0;s<n;s++)i+=r[s];var l=Math.floor(i/n);return Math.max(l,e)}function s(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var a="visualVariables"in t?n(r,t.visualVariables):r;if("simple"===t.type)return i(a,t.symbol);if("unique-value"===t.type){var s=a;return t.uniqueValueInfos.forEach((function(e){s=i(s,e.symbol)})),s}if("class-breaks"===t.type){var l=a;return t.classBreakInfos.forEach((function(e){l=i(l,e.symbol)})),l}return t.type,a}r.d(t,"a",(function(){return s}))},500:function(e,t,r){"use strict";var i,a=r(28),n=r(2),s=r(3),l=r(5),o=r(4),u=r(0),c=(r(12),r(18)),h=r(8),f=r(10),p=r(1),d=r(44),y=r(6),m=r(19),b=(r(9),r(15),r(16),r(20)),v=f.a.getLogger("esri.layers.support.PixelBlock"),x=i=function(e){Object(l.a)(r,e);var t=Object(o.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).width=null,i.height=null,i.pixelType="f32",i.validPixelCount=null,i.mask=null,i.maskIsAlpha=!1,i.pixels=null,i.statistics=null,i}return Object(s.a)(r,[{key:"castPixelType",value:function(e){if(!e)return"f32";var t=e.toLowerCase();return["u1","u2","u4"].indexOf(t)>-1?t="u8":-1===["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].indexOf(t)&&(t="f32"),t}},{key:"getPlaneCount",value:function(){return this.pixels&&this.pixels.length}},{key:"addData",value:function(e){if(!e.pixels||e.pixels.length!==this.width*this.height)throw new m.a("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push(e.statistics||{minValue:null,maxValue:null})}},{key:"getAsRGBA",value:function(){var e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)}},{key:"getAsRGBAFloat",value:function(){var e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e}},{key:"updateStatistics",value:function(){var e=this;this.statistics=this.pixels.map((function(t){return e._calculateBandStatistics(t,e.mask)}));var t=this.mask,r=0;if(t)for(var i=0;i<t.length;i++)t[i]&&r++;else r=this.width*this.height;this.validPixelCount=r}},{key:"clamp",value:function(e){if(e&&"f64"!==e&&"f32"!==e){var t;switch(e){case"u8":t=[0,255];break;case"u16":t=[0,65535];break;case"u32":t=[0,4294967295];break;case"s8":t=[-128,127];break;case"s16":t=[-32768,32767];break;case"s32":t=[-2147483648,2147483647];break;default:t=[-34e38,34e38]}for(var r,n,s,l=t,o=Object(a.a)(l,2),u=o[0],c=o[1],h=this.pixels,f=this.width*this.height,p=h.length,d=[],y=0;y<p;y++){s=i.createEmptyBand(e,f),r=h[y];for(var m=0;m<f;m++)n=r[m],s[m]=n>c?c:n<u?u:n;d.push(s)}this.pixels=d,this.pixelType=e}}},{key:"extractBands",value:function(e){var t=this;if(Object(h.h)(e)||0===e.length||null==this.pixels||0===this.pixels.length)return this;var r=this.pixels.length,a=e.some((function(e){return e>=t.pixels.length})),n=r===e.length&&!e.some((function(e,t){return e!==t}));return a||n?this:new i({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:e.map((function(e){return t.pixels[e]})),statistics:this.statistics&&e.map((function(e){return t.statistics[e]}))})}},{key:"clone",value:function(){var e,t=new i({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(this.mask instanceof Uint8Array?t.mask=new Uint8Array(this.mask):t.mask=this.mask.slice(0));var r=i.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];var a=this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=a?this.pixels[e].slice(0,this.pixels[e].length):new r(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=Object(c.a)(this.statistics[e]);return t}},{key:"_fillFrom8Bit",value:function(e){var t=this.mask,r=this.maskIsAlpha,i=this.pixels;if(e&&i&&i.length){var a,n,s,l;a=n=s=i[0],i.length>=3?(n=i[1],s=i[2]):2===i.length&&(n=i[1]);var o=new Uint32Array(e),u=this.width*this.height;if(a.length===u)if(t&&t.length===u)if(r)for(l=0;l<u;l++)t[l]&&(o[l]=t[l]<<24|s[l]<<16|n[l]<<8|a[l]);else for(l=0;l<u;l++)t[l]&&(o[l]=255<<24|s[l]<<16|n[l]<<8|a[l]);else for(l=0;l<u;l++)o[l]=255<<24|s[l]<<16|n[l]<<8|a[l];else v.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}else v.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}},{key:"_fillFromNon8Bit",value:function(e){var t=this.pixels,r=this.mask,i=this.statistics;if(e&&t&&t.length){var a=this.pixelType,n=1,s=0;if(i&&i.length>0)s=i.map((function(e){return e.minValue})).reduce((function(e,t){return Math.min(e,t)})),n=255/i.map((function(e){return e.maxValue-e.minValue})).reduce((function(e,t){return Math.max(e,t)}));else{var l=255;"s8"===a?(s=-128,l=127):"u16"===a?l=65535:"s16"===a?(s=-32768,l=32767):"u32"===a?l=4294967295:"s32"===a?(s=-2147483648,l=2147483647):"f32"===a?(s=-34e38,l=34e38):"f64"===a&&(s=-Number.MAX_VALUE,l=Number.MAX_VALUE),n=255/(l-s)}var o,u,c,h,f,p=new Uint32Array(e),d=this.width*this.height;if((o=u=c=t[0]).length!==d)return v.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(u=t[1],t.length>=3&&(c=t[2]),r&&r.length===d)for(h=0;h<d;h++)r[h]&&(p[h]=255<<24|(c[h]-s)*n<<16|(u[h]-s)*n<<8|(o[h]-s)*n);else for(h=0;h<d;h++)p[h]=255<<24|(c[h]-s)*n<<16|(u[h]-s)*n<<8|(o[h]-s)*n;else if(r&&r.length===d)for(h=0;h<d;h++)f=(o[h]-s)*n,r[h]&&(p[h]=255<<24|f<<16|f<<8|f);else for(h=0;h<d;h++)f=(o[h]-s)*n,p[h]=255<<24|f<<16|f<<8|f}else v.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}},{key:"_fillFrom32Bit",value:function(e){var t,r,i,a,n=this.pixels,s=this.mask;if(!e||!n||!n.length)return v.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");t=r=i=n[0],n.length>=3?(r=n[1],i=n[2]):2===n.length&&(r=n[1]);var l=this.width*this.height;if(t.length!==l)return v.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var o=0;if(s&&s.length===l)for(a=0;a<l;a++)e[o++]=t[a],e[o++]=r[a],e[o++]=i[a],e[o++]=1&s[a];else for(a=0;a<l;a++)e[o++]=t[a],e[o++]=r[a],e[o++]=i[a],e[o++]=1}},{key:"_calculateBandStatistics",value:function(e,t){var r,i=1/0,a=-1/0,n=e.length,s=0;if(t)for(r=0;r<n;r++)t[r]&&(i=(s=e[r])<i?s:i,a=s>a?s:a);else for(r=0;r<n;r++)i=(s=e[r])<i?s:i,a=s>a?s:a;return{minValue:i,maxValue:a}}}],[{key:"createEmptyBand",value:function(e,t){return new(i.getPixelArrayConstructor(e))(t)}},{key:"getPixelArrayConstructor",value:function(e){var t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"u32":t=Uint32Array;break;case"f32":t=Float32Array;break;case"f64":t=Float64Array;break;case"c64":case"c128":case"unknown":t=Float32Array}return t}}]),r}(b.a);Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"width",void 0),Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"height",void 0),Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"pixelType",void 0),Object(u.a)([Object(d.a)("pixelType")],x.prototype,"castPixelType",null),Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"validPixelCount",void 0),Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"mask",void 0),Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"maskIsAlpha",void 0),Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"pixels",void 0),Object(u.a)([Object(p.b)({json:{write:!0}})],x.prototype,"statistics",void 0);var g=x=i=Object(u.a)([Object(y.a)("esri.layers.support.PixelBlock")],x);t.a=g},502:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return o})),r.d(t,"h",(function(){return n})),r.d(t,"i",(function(){return p})),r.d(t,"j",(function(){return b})),r.d(t,"k",(function(){return m})),r.d(t,"l",(function(){return d})),r.d(t,"m",(function(){return v})),r.d(t,"n",(function(){return _})),r.d(t,"o",(function(){return f}));var i=r(500),a=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0};function n(e,t){if(null==t||!t.length||!a(e))return e;var r=e.pixels.length;return t&&t.some((function(e){return e>=r}))||1===r&&1===t.length&&0===t[0]?e:r!==t.length||t.some((function(e,t){return e!==t}))?new i.a({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:t.map((function(t){return e.pixels[t]})),statistics:e.statistics&&t.map((function(t){return e.statistics[t]}))}):e}function s(e){if(e){var t=e.colormap;if(t&&0!==t.length){var r=t.sort((function(e,t){return e[0]-t[0]})),i=0;r[0][0]<0&&(i=r[0][0]);var a,n=Math.max(256,r[r.length-1][0]-i+1),s=new Uint8Array(4*n),l=[],o=0,u=0,c=5===r[0].length;if(n>65536)return r.forEach((function(e){l[e[0]-i]=c?e.slice(1):e.slice(1).concat([255])})),{indexed2DColormap:l,offset:i,alphaSpecified:c};if(e.fillUnspecified)for(o=(a=r[u])[0]-i;o<n;o++)s[4*o]=a[1],s[4*o+1]=a[2],s[4*o+2]=a[3],s[4*o+3]=c?a[4]:255,o===a[0]-i&&(a=u===r.length-1?a:r[++u]);else for(o=0;o<r.length;o++)s[u=4*((a=r[o])[0]-i)]=a[1],s[u+1]=a[2],s[u+2]=a[3],s[u+3]=c?a[4]:255;return{indexedColormap:s,offset:i,alphaSpecified:c}}}}function l(e,t){if(!a(e))return e;if(!t&&(t.indexedColormap||t.indexed2DColormap))return e;var r=e.clone(),i=r.pixels,n=r.mask,s=r.width*r.height;if(1!==i.length)return e;var l,o=t.indexedColormap,u=t.indexed2DColormap,c=t.offset,h=t.alphaSpecified,f=o.length-1,p=0,d=i[0],y=new Uint8Array(d.length),m=new Uint8Array(d.length),b=new Uint8Array(d.length),v=0;if(o)if(n)for(p=0;p<s;p++)n[p]&&((v=4*(d[p]-c))<c||v>f?n[p]=0:(y[p]=o[v],m[p]=o[v+1],b[p]=o[v+2],n[p]=o[v+3]));else{for(n=new Uint8Array(s),p=0;p<s;p++)(v=4*(d[p]-c))<c||v>f?n[p]=0:(y[p]=o[v],m[p]=o[v+1],b[p]=o[v+2],n[p]=o[v+3]);r.mask=n}else if(n)for(p=0;p<s;p++)n[p]&&(l=u[d[p]],y[p]=l[0],m[p]=l[1],b[p]=l[2],n[p]=l[3]);else{for(n=new Uint8Array(s),p=0;p<s;p++)l=u[d[p]],y[p]=l[0],m[p]=l[1],b[p]=l[2],n[p]=l[3];r.mask=n}return r.pixels=[y,m,b],r.statistics=null,r.pixelType="u8",r.maskIsAlpha=h,r}function o(e){if(!a(e))return null;e.statistics||e.updateStatistics();var t,r,i,n,s,l,o,u,c,h,f,p,d,y,m=e.pixels,b=e.mask,v=e.pixelType,x=e.statistics,g=e.width*e.height,j=m.length,w=[],O=[],k=256;for(n=0;n<j;n++){if(l=new Uint32Array(k),u=m[n],"u8"===v)if(t=-.5,r=255.5,b)for(s=0;s<g;s++)b[s]&&l[u[s]]++;else for(s=0;s<g;s++)l[u[s]]++;else{if(t=x[n].minValue,i=((r=x[n].maxValue)-t)/k,o=new Uint32Array(257),b)for(s=0;s<g;s++)b[s]&&o[Math.floor((u[s]-t)/i)]++;else for(s=0;s<g;s++)o[Math.floor((u[s]-t)/i)]++;for(s=0;s<255;s++)l[s]=o[s];l[255]=o[255]+o[256]}for(w.push({min:t,max:r,size:k,counts:l}),c=0,h=0,d=0,s=0;s<k;s++)c+=l[s],h+=s*l[s];for(y=h/c,s=0;s<k;s++)d+=l[s]*Math.pow(s-y,2);f=(y+.5)*(i=(r-t)/k)+t,p=Math.sqrt(d/(c-1))*i,O.push({min:t,max:r,avg:f,stddev:p})}return{statistics:O,histograms:w}}function u(e){for(var t=[],r=0;r<e.length;r++){for(var i=e[r],a=i.min,n=i.max,s=i.size,l=i.counts,o=0,u=0,c=0;c<s;c++)o+=l[c],u+=c*l[c];for(var h=u/o,f=0,p=0;p<s;p++)f+=l[p]*Math.pow(p-h,2);var d=(n-a)/s,y=(h+.5)*d+a,m=Math.sqrt(f/(o-1))*d;t.push({min:a,max:n,avg:y,stddev:m})}return t}function c(e){var t=e.minCutOff,r=e.maxCutOff,i=e.gamma,a=e.pixelType,n=e.outMin||0,s=e.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(a))return null;var l,o,u=t.length,c=0;"s8"===a?c=-127:"s16"===a&&(c=-32767);var h=256;["u16","s16"].indexOf(a)>-1&&(h=65536);var f=[],p=[],d=s-n;for(l=0;l<u;l++)p[l]=r[l]-t[l],f[l]=d/(r[l]-t[l]);var y,m=i&&i.length>=u,b=[];if(m)for(l=0;l<u;l++)i[l]>1?i[l]>2?b[l]=6.5+Math.pow(i[l]-2,2.5):b[l]=6.5+100*Math.pow(2-i[l],4):b[l]=1;var v,x,g,j=[];if(m)for(l=0;l<u;l++){for(g=[],o=0;o<h;o++)y=((v=o+c)-t[l])/p[l],x=1,i[l]>1&&(x-=Math.pow(1/d,y*b[l])),v<r[l]&&v>t[l]?g[o]=Math.floor(x*d*Math.pow(y,1/i[l]))+n:v>=r[l]?g[o]=s:g[o]=n;j[l]=g}else for(l=0;l<u;l++){for(g=[],o=0;o<h;o++)(v=o+c)<=t[l]?g[o]=n:v>=r[l]?g[o]=s:g[o]=Math.floor((v-t[l])/p[l]*d)+n;j[l]=g}if(null!=e.contrastOffset){var w=function(e,t){var r,i,a=Math.min(Math.max(e,-100),100),n=Math.min(Math.max(t,-100),100),s=255,l=128,o=new Uint8Array(256);for(r=0;r<256;r++)a>0&&a<100?i=(200*r-100*s+2*s*n)/(2*(100-a))+l:a<=0&&a>-100?i=(200*r-100*s+2*s*n)*(100+a)/2e4+l:100===a?i=(i=200*r-100*s+(s+1)*(100-a)+2*s*n)>0?s:0:-100===a&&(i=l),o[r]=i>s?s:i<0?0:i;return o}(e.contrastOffset,e.brightnessOffset);for(l=0;l<u;l++)for(g=j[l],o=0;o<h;o++)g[o]=w[g[o]]}return{lut:j,offset:c}}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256;t=Math.min(t,256);for(var r=e.size,i=e.counts,a=new Uint8Array(r),n=i.reduce((function(e,r){return e+r/t}),0),s=0,l=0,o=0,u=n,c=0;c<r;c++)if(o+=i[c],!(c<r-1&&o+i[c+1]<u)){for(;s<t-1&&u<o;)s++,u+=n;for(var h=l;h<=c;h++)a[h]=s;l=c+1}for(var f=l;f<r;f++)a[f]=t-1;return a}function f(e,t){if(!a(e))return null;var r,i,n,s,l,o=e.clone(),u=o.pixels,c=o.mask,h=t.minCutOff,f=t.maxCutOff,p=t.gamma,d=t.outMin||0,y=t.outMax||255,m=o.width*o.height,b=u.length,v=y-d,x=[],g=[];for(r=0;r<b;r++)g[r]=f[r]-h[r],x[r]=v/(f[r]-h[r]);var j=p&&p.length>=b,w=[];if(j)for(r=0;r<b;r++)p[r]>1?p[r]>2?w[r]=6.5+Math.pow(p[r]-2,2.5):w[r]=6.5+100*Math.pow(2-p[r],4):w[r]=1;if(j)if(null!=c){for(i=0;i<m;i++)if(c[i])for(r=0;r<b;r++)l=((n=u[r][i])-h[r])/g[r],s=1,p[r]>1&&(s-=Math.pow(1/v,l*w[r])),n<f[r]&&n>h[r]?u[r][i]=Math.floor(s*v*Math.pow(l,1/p[r]))+d:n>=f[r]?u[r][i]=y:u[r][i]=d}else for(i=0;i<m;i++)for(r=0;r<b;r++)l=((n=u[r][i])-h[r])/g[r],s=1,p[r]>1&&(s-=Math.pow(1/v,l*w[r])),n<f[r]&&n>h[r]?u[r][i]=Math.floor(s*v*Math.pow(l,1/p[r]))+d:n>=f[r]?u[r][i]=y:u[r][i]=d;else if(null!=c){for(i=0;i<m;i++)if(c[i])for(r=0;r<b;r++)(n=u[r][i])<f[r]&&n>h[r]?u[r][i]=Math.floor((n-h[r])/g[r]*v)+d:n>=f[r]?u[r][i]=y:u[r][i]=d}else for(i=0;i<m;i++)for(r=0;r<b;r++)(n=u[r][i])<f[r]&&n>h[r]?u[r][i]=Math.floor((n-h[r])/g[r]*v)+d:n>=f[r]?u[r][i]=y:u[r][i]=d;return o.pixelType="u8",o.updateStatistics(),o}function p(e,t){if(!a(e))return null;var r,n,s=e.pixels,l=e.mask,o=e.width*e.height,u=s.length,c=t.lut,h=t.offset;c&&1===c[0].length&&(c=s.map((function(){return c})));var f,p,d,y=[];if(h)if(null==l)for(r=0;r<u;r++){for(f=s[r],p=c[r],d=new Uint8Array(o),n=0;n<o;n++)d[n]=p[f[n]-h];y.push(d)}else for(r=0;r<u;r++){for(f=s[r],p=c[r],d=new Uint8Array(o),n=0;n<o;n++)l[n]&&(d[n]=p[f[n]-h]);y.push(d)}else if(null==l)for(r=0;r<u;r++){for(f=s[r],p=c[r],d=new Uint8Array(o),n=0;n<o;n++)d[n]=p[f[n]];y.push(d)}else for(r=0;r<u;r++){for(f=s[r],p=c[r],d=new Uint8Array(o),n=0;n<o;n++)l[n]&&(d[n]=p[f[n]]);y.push(d)}var m=new i.a({width:e.width,height:e.height,pixels:y,mask:l,pixelType:"u8"});return m.updateStatistics(),m}function d(e,t){if(!a(e))return null;var r,i,n,s,l,o,u=e.clone(),c=u.pixels,h=u.width*u.height,f=t.length,p=Math.floor(f/2),d=t[Math.floor(p)],y=c[0],m=!1,b=new Uint8Array(h),v=new Uint8Array(h),x=new Uint8Array(h),g=u.mask,j=4===t[0].mappedColor.length;for(g||((g=new Uint8Array(h)).fill(j?255:1),u.mask=g),l=0;l<h;l++)if(g[l]){for(r=y[l],m=!1,o=p,i=d,n=0,s=f-1;s-n>1;){if(r===i.value){m=!0;break}r>i.value?n=o:s=o,o=Math.floor((n+s)/2),i=t[Math.floor(o)]}m||(r===t[n].value?(i=t[n],m=!0):r===t[s].value?(i=t[s],m=!0):r<t[n].value?(m=!1,i=null):r>t[n].value&&(r<t[s].value?(i=t[n],m=!0):s===f-1?(m=!1,i=null):(i=t[s],m=!0))),m?(b[l]=i.mappedColor[0],v[l]=i.mappedColor[1],x[l]=i.mappedColor[2],g[l]=i.mappedColor[3]):b[l]=v[l]=x[l]=g[l]=0}return u.pixels=[b,v,x],u.mask=g,u.pixelType="u8",u.maskIsAlpha=j,u}function y(e,t,r,i,a,n,s,l){return{xmin:a<=r*e?0:a<r*e+e?a-r*e:e,ymin:n<=i*t?0:n<i*t+t?n-i*t:t,xmax:a+s<=r*e?0:a+s<r*e+e?a+s-r*e:e,ymax:n+l<=i*t?0:n+l<i*t+t?n+l-i*t:t}}function m(e,t){if(!e||0===e.length)return null;var r=e.filter((function(e){return e.pixelBlock}))[0];if(!r)return null;var i=(r.extent.xmax-r.extent.xmin)/r.pixelBlock.width,a=(r.extent.ymax-r.extent.ymin)/r.pixelBlock.height,n=.01*Math.min(i,a),s=e.sort((function(e,t){return Math.abs(e.extent.ymax-t.extent.ymax)>n?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>n?e.extent.xmin-t.extent.xmin:0})),l=Math.min.apply(null,s.map((function(e){return e.extent.xmin}))),o=Math.min.apply(null,s.map((function(e){return e.extent.ymin}))),u=Math.max.apply(null,s.map((function(e){return e.extent.xmax}))),c=Math.max.apply(null,s.map((function(e){return e.extent.ymax}))),h={x:Math.round((t.xmin-l)/i),y:Math.round((c-t.ymax)/a)},f={width:Math.round((u-l)/i),height:Math.round((c-o)/a)},p={width:Math.round((t.xmax-t.xmin)/i),height:Math.round((t.ymax-t.ymin)/a)};return Math.round(f.width/r.pixelBlock.width)*Math.round(f.height/r.pixelBlock.height)!==s.length||h.x<0||h.y<0||f.width<p.width||f.height<p.height?null:{extent:t,pixelBlock:b(s.map((function(e){return e.pixelBlock})),f,h,p)}}function b(e,t,r,n){var s=e.filter((function(e){return a(e)}))[0];if(null==s)return null;var l,o,u,c,h,f,p,d,m,b,v,x,g,j=n?n.width:t.width,w=n?n.height:t.height,O=s.width,k=s.height,_=t.width/O,T=t.height/k,R=r?r.x:0,M=r?r.y:0,I=s.pixelType,P=i.a.getPixelArrayConstructor(I),C=s.pixels.length,S=[];for(f=0;f<C;f++){for(o=new P(j*w),p=0;p<T;p++)for(d=0;d<_;d++)if(u=e[p*_+d],a(u))for(l=u.pixels[f],m=(v=y(O,k,d,p,R,M,j,w)).ymin;m<v.ymax;m++)for(c=(p*k+m-M)*j+(d*O-R),h=m*O,b=v.xmin;b<v.xmax;b++)o[c+b]=l[h+b];S.push(o)}if(e.some((function(e){return null==e||e.mask&&e.mask.length>0})))for(x=new Uint8Array(j*w),p=0;p<T;p++)for(d=0;d<_;d++)if(g=(u=e[p*_+d])?u.mask:null,v=y(O,k,d,p,R,M,j,w),g)for(m=v.ymin;m<v.ymax;m++)for(c=(p*k+m-M)*j+(d*O-R),h=m*O,b=v.xmin;b<v.xmax;b++)x[c+b]=g[h+b];else if(u)for(m=v.ymin;m<v.ymax;m++)for(c=(p*k+m-M)*j+(d*O-R),h=m*O,b=v.xmin;b<v.xmax;b++)x[c+b]=1;else for(m=v.ymin;m<v.ymax;m++)for(c=(p*k+m-M)*j+(d*O-R),h=m*O,b=v.xmin;b<v.xmax;b++)x[c+b]=0;var U=new i.a({width:j,height:w,pixels:S,pixelType:I,mask:x});return U.updateStatistics(),U}function v(e,t,r){if(!a(e))return null;var i=e.width,n=e.height,s=t.x,l=t.y,o=r.width+s,u=r.height+l;if(s<0||l<0||o>i||u>n)return e;if(0===s&&0===l&&o===i&&u===n)return e;e.mask||(e.mask=new Uint8Array(i*n));for(var c=e.mask,h=0;h<n;h++)for(var f=h*i,p=0;p<i;p++)c[f+p]=h<l||h>=u||p<s||p>=o?0:1;return e.updateStatistics(),e}function x(e){if(!a(e))return null;for(var t=e.clone(),r=e.width,i=e.height,n=e.pixels,s=e.mask,l=n[0],o=t.pixels[0],u=2;u<i-1;u++){for(var c=new Map,h=u-2;h<u+2;h++)for(var f=0;f<4;f++){var p=h*r+f;w(c,l[p],s?s[p]:1)}o[u*r]=g(c),o[u*r+1]=o[u*r+2]=o[u*r];for(var d=3;d<r-1;d++){var y=(u-2)*r+d+1;w(c,l[y],s?s[y]:1),w(c,l[y=(u-1)*r+d+1],s?s[y]:1),w(c,l[y=u*r+d+1],s?s[y]:1),w(c,l[y=(u+1)*r+d+1],s?s[y]:1),j(c,l[y=(u-2)*r+d-3],s?s[y]:1),j(c,l[y=(u-1)*r+d-3],s?s[y]:1),j(c,l[y=u*r+d-3],s?s[y]:1),j(c,l[y=(u+1)*r+d-3],s?s[y]:1),o[u*r+d]=g(c)}o[u*r+d+1]=o[u*r+d]}for(var m=0;m<r;m++)o[m]=o[r+m]=o[2*r+m],o[(i-1)*r+m]=o[(i-2)*r+m];return t.updateStatistics(),t}function g(e){if(0===e.size)return 0;for(var t=0,r=-1,i=0,a=e.keys(),n=a.next();!n.done;)(i=e.get(n.value))>t&&(r=n.value,t=i),n=a.next();return r}function j(e,t,r){if(0!==r){var i=e.get(t);1===i?e.delete(t):e.set(t,i-1)}}function w(e,t,r){0!==r&&e.set(t,e.has(t)?e.get(t)+1:1)}function O(e,t,r){var n=t.x,s=t.y,l=r.width,o=r.height;if(0===n&&0===s&&o===e.height&&l===e.width)return e;var u=e.width,c=e.height,h=Math.max(0,s),f=Math.max(0,n),p=Math.min(n+l,u),d=Math.min(s+o,c);if(p<0||d<0||!a(e))return null;n=Math.max(0,-n),s=Math.max(0,-s);for(var y=e.pixels,m=e.mask,b=l*o,v=y.length,x=[],g=0;g<v;g++){for(var j=y[g],w=i.a.createEmptyBand(e.pixelType,b),O=h;O<d;O++)for(var k=O*u,_=(O+s-h)*l+n,T=f;T<p;T++)w[_++]=j[k+T];x.push(w)}for(var R=new Uint8Array(b),M=h;M<d;M++)for(var I=M*u,P=(M+s-h)*l+n,C=f;C<p;C++)R[P++]=m?m[I+C]:1;var S=new i.a({width:r.width,height:r.height,pixelType:e.pixelType,pixels:x,mask:R});return S.updateStatistics(),S}function k(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!a(e))return null;for(var r=e.pixels,n=e.width,s=e.height,l=e.mask,o=e.pixelType,u=[],c=Math.round(n/2),h=Math.round(s/2),f=s-1,p=n-1,d=0;d<r.length;d++){for(var y=r[d],m=i.a.createEmptyBand(o,c*h),b=0,v=0;v<s;v+=2)for(var x=0;x<n;x+=2){var g=y[v*n+x];if(t){var j=x===p?g:y[v*n+x+1],w=v===f?g:y[v*n+x+n],O=x===p?w:v===f?j:y[v*n+x+n+1];m[b++]=(g+j+w+O)/4}else m[b++]=g}u.push(m)}var k=null;if(l){k=new Uint8Array(c*h);for(var _=0,T=0;T<s;T+=2)for(var R=0;R<n;R+=2){var M=l[T*n+R];if(t){var I=R===p?M:l[T*n+R+1],P=T===f?M:l[T*n+R+n],C=R===p?P:T===f?I:l[T*n+R+n+1];k[_++]=M*I*P*C?1:0}else k[_++]=M}}return new i.a({width:c,height:h,pixelType:o,pixels:u,mask:k})}function _(e,t,r){if(!a(e))return null;for(var i=t.width,n=t.height,s=e.width,l=e.height,o=new Map,u={x:0,y:0},c=null==r?1:1+r,h=e,f=0;f<c;f++){for(var p=Math.ceil(s/i),d=Math.ceil(l/n),y=0;y<d;y++){u.y=y*n;for(var m=0;m<p;m++){u.x=m*i;var b=O(h,u,t);o.set("".concat(f,"/").concat(y,"/").concat(m),b)}}f<c-1&&(h=k(h)),s=Math.round(s/2),l=Math.round(l/2)}return o}function T(e,t,r,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"nearest";if(!a(e))return null;"majority"===s&&(e=x(e));for(var l,o,u,c,h,f,p,d=e,y=d.pixels,m=d.mask,b=d.pixelType,v=e.width,g=e.height,j=i.a.getPixelArrayConstructor(b),w=y.length,O=t.width,k=t.height,_=n.cols,T=n.rows,R=Math.ceil(O/_),M=Math.ceil(k/T),I=!1,P=0;P<r.length;P+=3)-1===r[P]&&-1===r[P+1]&&-1===r[P+2]&&(I=!0);for(var C,S,U=new Float32Array(O*k),A=new Float32Array(O*k),B=0,z="majority"===s?0:.5,V=0;V<M;V++)for(var G=0;G<R;G++){o=r[l=12*(V*R+G)],u=r[l+1],c=r[l+2],h=r[l+3],f=r[l+4],p=r[l+5];for(var q=0;q<T;q++){B=(V*T+q)*O+G*_,S=(q+.5)/T;for(var F=0;F<q;F++)C=(F+.5)/_,U[B+F]=Math.round((o*C+u*S+c)*v-z),A[B+F]=Math.round((h*C+f*S+p)*g-z)}o=r[l+=6],u=r[l+1],c=r[l+2],h=r[l+3],f=r[l+4],p=r[l+5];for(var L=0;L<T;L++){B=(V*T+L)*O+G*_,S=(L+.5)/T;for(var E=L;E<_;E++)C=(E+.5)/_,U[B+E]=Math.round((o*C+u*S+c)*v-z),A[B+E]=Math.round((h*C+f*S+p)*g-z)}}for(var D,N=function(e,t){for(var r=0;r<k;r++){l=r*O;for(var i=0;i<O;i++)U[l]<0||A[l]<0?e[l]=0:e[l]=t[U[l]+A[l]*v],l++}},W=[],Q=0;Q<w;Q++)N(D=new j(O*k),y[Q]),W.push(D);var H=new i.a({width:O,height:k,pixelType:b,pixels:W});if(m)H.mask=new Uint8Array(O*k),N(H.mask,m);else if(I){H.mask=new Uint8Array(O*k);for(var J=0;J<O*k;J++)H.mask[J]=U[J]<0||A[J]<0?0:1}return H.updateStatistics(),H}},506:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(8),a=r(47),n=(r(69),r(51));r(489);function s(e,t,r){var s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.a;if("2d"===r.type)s=t*r.resolution;else if("3d"===r.type){var o=r.overlayPixelSizeInMapUnits(e),u=r.basemapSpatialReference;s=Object(i.i)(u)&&!u.equals(r.spatialReference)?Object(n.d)(u)/Object(n.d)(r.spatialReference):t*o}var c=e.x-s,h=e.y-s,f=e.x+s,p=e.y+s,d=r.spatialReference;return l.xmin=Math.min(c,f),l.ymin=Math.min(h,p),l.xmax=Math.max(c,f),l.ymax=Math.max(h,p),l.spatialReference=d,l}new a.a},507:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u}));var i=r(7),a=r.n(i),n=r(36),s=r(17),l=r(8),o=r(54);function u(e){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(a.a.mark((function e(t){var r,i,s,u,c,h,f,p,d,y=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y.length>1&&void 0!==y[1]?y[1]:t.popupTemplate,Object(l.i)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fields);case 5:if(i=e.sent,s=r.lastEditInfoEnabled,u=t.objectIdField,c=t.typeIdField,h=t.globalIdField,f=t.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,Object(o.m)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,d=Object(o.i)(t.fields,[].concat(Object(n.a)(i),Object(n.a)(p))),e.abrupt("return",(c&&d.push(c),d&&u&&Object(o.p)(t.fields,u)&&-1===d.indexOf(u)&&d.push(u),d&&h&&Object(o.p)(t.fields,h)&&-1===d.indexOf(h)&&d.push(h),f&&f.forEach((function(e){var r=e.keyField;d&&r&&Object(o.p)(t.fields,r)&&-1===d.indexOf(r)&&d.push(r)})),d));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return e.popupTemplate?e.popupTemplate:Object(l.i)(t)&&t.defaultPopupTemplateEnabled&&Object(l.i)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},523:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return k})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return w})),r.d(t,"g",(function(){return g})),r.d(t,"h",(function(){return _}));var i=r(7),a=r.n(i),n=r(28),s=r(17),l=r(19),o=r(38),u=r(48),c=r(43),h=r(47),f=(r(69),r(51)),p=r(306),d=5e-4,y=function(e,t){var r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)},m=function(e,t){var r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,i=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(i-e[2*t.rows+3])]};function b(){return v.apply(this,arguments)}function v(){return(v=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(p.d)()&&Object(p.e)()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,Object(p.f)();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t,r){if(!y(e.spatialReference,t))return null;if(!Object(p.d)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");return r?Object(p.b)(t,e.spatialReference,e):Object(p.b)(e.spatialReference,t,e)}function g(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e.spatialReference.equals(t))return e;var a=y(e.spatialReference,t);if(a&&!Object(p.d)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var n=r.center,s=new h.a({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:e.spatialReference}),o=a?Object(p.g)(s,t,i):Object(u.d)(s,t);return null==o?null:{x:o.xmax-o.xmin,y:o.ymax-o.ymin}}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return Object(f.d)(e)?t/Object(f.d)(e):0}function w(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.spatialReference;if(a.equals(t))return e;var s=y(a,t);if(s&&!Object(p.d)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var c=s?Object(p.g)(e,t,r):Object(u.d)(e,t);if(c&&i&&t.isGeographic){var h,f,m=a.isWebMercator?Object(o.d)(a).origin:null!=(h=null==(f=Object(o.d)(a))?void 0:f.valid)?h:[],b=Object(n.a)(m,2),v=b[0],x=b[1],g=j(a);g&&null!=v&&null!=x&&(Math.abs(e.x-v)<g&&Math.abs(180-c.x)<d?c.x-=360:Math.abs(e.x-x)<g&&Math.abs(180+c.x)<d&&(c.x+=360))}return c}function O(e,t){var r,i,a,s,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],m=e.spatialReference;if(m.equals(t))return e;var b=y(m,t);if(b&&!Object(p.d)())throw new l.a("rasterprojectionhelper-projectExtent","projection engine is not loaded");var v=b?Object(p.g)(e,t,h):Object(u.d)(e,t),x=null!=(r=null==(i=Object(o.d)(m))?void 0:i.origin)?r:[],g=Object(n.a)(x,2),O=g[0],k=g[1];if(v&&f&&m.isWebMercator&&t.isGeographic&&null!=O&&null!=k){var _=.001,T=1e3;if(Math.abs(e.xmin-O)<_&&Math.abs(k-e.xmax)>T&&Math.abs(180-v.xmax)<d){v.xmin=-180;var R=[];R.push(new c.a(e.xmax,e.ymin,m)),R.push(new c.a(e.xmax,(e.ymin+e.ymax)/2,m)),R.push(new c.a(e.xmax,e.ymax,m));var M=R.map((function(e){return w(e,t,h)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));v.xmax=Math.max.apply(null,M)}if(Math.abs(e.xmax-k)<_&&Math.abs(O-e.xmin)>T&&Math.abs(180+v.xmin)<d){v.xmax=180;var I=[];I.push(new c.a(e.xmin,e.ymin,m)),I.push(new c.a(e.xmin,(e.ymin+e.ymax)/2,m)),I.push(new c.a(e.xmin,e.ymax,m));var P=I.map((function(e){return w(e,t,h)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));v.xmin=Math.min.apply(null,P)}}var C=t.isWebMercator?Object(o.d)(t).origin:null!=(a=null==(s=Object(o.d)(t))?void 0:s.valid)?a:[],S=Object(n.a)(C,2);O=S[0],k=S[1];var U=j(t);return U&&null!=O&&null!=k&&(Math.abs(v.xmin-O)<U&&(v.xmin=O),Math.abs(v.xmax-k)<U&&(v.xmax=k)),v}function k(e,t,r){var i,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[32,32];if(y(e.spatialReference,t.spatialReference)&&!Object(p.d)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&r))return null;for(var d,b=e.xmin,v=e.ymin,x=e.xmax,g=e.ymax,j=e.spatialReference,O=t.spatialReference,k=null!=(i=null==(a=Object(o.d)(j))?void 0:a.valid)?i:[],_=Object(n.a)(k,2),T=_[0],R=_[1],M={x:f[0]*r.x,y:f[1]*r.y},I={cols:Math.ceil((x-b)/M.x-.1)+1,rows:Math.ceil((g-v)/M.y-.1)+1},P=M.x,C=M.y,S=[],U=!1,A=0;A<I.cols;A++){for(var B=[],z=0;z<I.rows;z++){var V=w(new c.a({x:b+P*A,y:g-C*z,spatialReference:j}),O,s);u&&(V=u.inverseTransform(V)),B.push(V),A>0&&h&&V&&d[z]&&null!=T&&V.x<d[z].x&&(V.x+=R-T),V?(S.push((V.x-t.xmin)/(t.xmax-t.xmin)),S.push((t.ymax-V.y)/(t.ymax-t.ymin))):(S.push(NaN),S.push(NaN),U=!0)}d=B}for(var G=m(S,I),q=new Float32Array((I.cols-1)*(I.rows-1)*2*6),F=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),L=new Float32Array([-1,1,0,0,-1,1,1,0,0]),E=0;E<I.cols-1;E++){for(var D=0;D<I.rows-1;D++){for(var N=E*I.rows*2+2*D,W=S[N],Q=S[N+1],H=S[N+2],J=S[N+3],X=S[N+=2*I.rows],Z=S[N+1],K=S[N+2],Y=S[N+3],$=0,ee=12*(D*(I.cols-1)+E),te=0;te<3;te++)q[ee++]=F[$++]*W+F[$++]*H+F[$++]*K;$=0;for(var re=0;re<3;re++)q[ee++]=F[$++]*Q+F[$++]*J+F[$++]*Y;$=0;for(var ie=0;ie<3;ie++)q[ee++]=L[$++]*W+L[$++]*X+L[$++]*K;$=0;for(var ae=0;ae<3;ae++)q[ee++]=L[$++]*Q+L[$++]*Z+L[$++]*Y}if(U)for(var ne=0;ne<q.length;ne++)isNaN(q[ne])&&(q[ne]=-1)}return{offsets:S,error:G,coefficients:q,spacing:f,size:[I.cols-1,I.rows-1]}}function _(e,t,r){var i=Math.log(e.x/t.pixelSize.x)/Math.LN2,a=Math.log(e.y/t.pixelSize.y)/Math.LN2,n=t.storageInfo.maximumPyramidLevel||0,s="down"===r?Math.floor(Math.min(i,a)):"up"===r?Math.ceil(Math.max(i,a)):Math.round((i+a)/2),l=!1;s<0?s=0:s>n&&(l=s>n+3,s=n);var o=Math.pow(2,s);return{pyramidLevel:s,pyramidResolution:new c.a({x:o*t.nativePixelSize.x,y:o*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}}function T(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.extent,n=e.spatialReference,s=e.pixelSize,l=g(new c.a({x:s.x,y:s.y,spatialReference:n}),t,a);if(null==l)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var o=(l.x+l.y)/2,u=Object(f.d)(t),h=o*u*96*39.37,p=t.isGeographic?512/r*295828763.7958547:512/r*591657527.591555,d=!1,y=O(a,t);i&&(t.isGeographic||t.isWebMercator)&&(d=y.xmin*y.xmax<0);var m,b=h,v=1.001;if(d){b=p;var x=.29858214164761665,j=x*(96*u*39.37);(m=g(new c.a({x:x,y:x,spatialReference:{wkid:3857}}),n,y)).x*=b/j,m.y*=b/j}else{m={x:s.x,y:s.y};for(var w=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),k=0;b<p*(v/2)&&k<w;)k++,b*=2,m.x*=2,m.y*=2;Math.max(b,p)/Math.min(b,p)<=v&&(b=p)}for(var _=[b],T=[{x:m.x,y:m.y}],R=70.5310735,M=Math.min(R,h)/v;b>=M;)b/=2,m.x/=2,m.y/=2,_.push(b),T.push({x:m.x,y:m.y});return{projectedPixelSize:l,scales:_,srcResolutions:T,isCustomTilingScheme:!d}}},679:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return x}));var i=r(8),a=r(43),n=(r(69),r(2)),s=r(3),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;Object(n.a)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return Object(s.a)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var a=i.get(r);return a.refCount--,a.refCount<=0&&(i.delete(r),a.controller&&a.controller.abort()),a.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var a=i.get(r);return a.ts=Date.now(),a.refCount++,i.delete(r),i.set(r,a),a.block}return null}},{key:"putBlock",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this._cachedBlocks,n=e+"/"+t;if(a.has(n)){var s=a.get(n);s.ts=Date.now(),s.refCount++}else a.set(n,{block:r,ts:Date.now(),refCount:1,controller:i});this.trim(),this.updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,i=e+"/"+t;r.has(i)&&r.delete(i)}},{key:"updateMaxSize",value:function(e){this._size=e,this.trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this.clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),i=Date.now(),a=0;a<r.length&&r[a][1].ts<=i-e._duration;a++)t.delete(r[a][0]);0===t.size&&e.clearTimer()}),this._interval)}}},{key:"trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),o=r(523),u=new Map,c=new l;function h(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function f(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(u.has(e)){var i=u.get(e);return i.push(r),i.length-1}return u.set(e,[r]),0}function p(e,t){if(u.has(e)){var r=u.get(e);r[t]=null,r.some((function(e){return null!=e}))||u.delete(e)}}function d(e,t,r){if(!u.has(e))return null==t?c.decreaseRefCount(e,r):0;var i=u.get(e);if(null==i[t])return c.decreaseRefCount(e,r);var a=i[t].cache;if(a.has(r)){var n=a.get(r);if(n.refCount--,0===n.refCount){a.delete(r);for(var s=0;s<i.length;s++)i[s]&&i[s].cache.has(r)&&i[s].cache.delete(r);n.controller&&n.controller.abort()}return n.refCount}return 0}function y(e,t,r){if(!u.has(e))return null==t?c.getBlock(e,r):null;var i=u.get(e);if(null==i[t]){for(var a=0;a<i.length;a++)if(i[a]&&i[a].cache.has(r)){var n=i[a].cache.get(r);return n.refCount++,n.block}return c.getBlock(e,r)}var s=i[t].cache;if(s.has(r)){var l=s.get(r);return l.refCount++,l.block}for(var o=0;o<i.length;o++)if(o!==t&&i[o]&&i[o]&&i[o].cache.has(r)){var h=i[o].cache.get(r);return h.refCount++,s.set(r,h),h.block}return null}function m(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(u.has(e)){var n=u.get(e);if(null!=n[t]){var s={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:a};i.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),n[t].cache.set(r,s)}else c.putBlock(e,r,i,a)}else null==t&&c.putBlock(e,r,i,a)}function b(e,t,r){if(u.has(e)){var i=u.get(e);null!=i[t]?i[t].cache.delete(r):c.deleteBlock(e,r)}else null==t&&c.deleteBlock(e,r)}function v(e,t){if(!u.has(e))return null;var r=u.get(e);return null==r[t]?null:r[t]}function x(e,t,r,n,s,l){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=v(e,t),h=c.extent,f=c.cache,p=c.rasterInfo;if(!h||h.xmin!==r.xmin||h.xmax!==r.xmax||h.ymin!==r.ymin||h.ymax!==r.ymax){for(var d=r.clone().normalize(),y=p.spatialReference,m=p.transform,b=new Set,x=0;x<d.length;x++){var g=d[x];if(!(g.xmax-g.xmin<=n||g.ymax-g.ymin<=n)){var j=Object(o.e)(g,y,u);Object(i.i)(m)&&(j=m.inverseTransform(j));var w=new a.a({x:n,y:n,spatialReference:g.spatialReference});if(null==s&&!(s=Object(o.g)(w,y,g,u)))return;var O=Object(o.h)(s,p,l||"closest"),k=O.pyramidLevel,_=O.pyramidResolution,T=O.excessiveReading;if(T)return;for(var R=p.storageInfo,M=R.origin,I={x:Math.max(0,Math.floor((j.xmin-M.x)/_.x)),y:Math.max(0,Math.floor((M.y-j.ymax)/_.y))},P=Math.ceil((j.xmax-j.xmin)/_.x-.1),C=Math.ceil((j.ymax-j.ymin)/_.y-.1),S=k>0?R.pyramidBlockWidth:R.blockWidth,U=k>0?R.pyramidBlockHeight:R.blockHeight,A=1,B=Math.max(0,Math.floor(I.x/S)-A),z=Math.max(0,Math.floor(I.y/U)-A),V=Math.floor((I.x+P-1)/S)+A,G=Math.floor((I.y+C-1)/U)+A,q=z;q<=G;q++)for(var F=B;F<=V;F++)b.add("".concat(k,"/").concat(q,"/").concat(F))}}f.forEach((function(e,t){if(!b.has(t)){var r=f.get(t);(null==r||r.isResolved||r.isRejected)&&f.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}},881:function(e,t,r){"use strict";r.r(t);var i=r(28),a=r(7),n=r.n(a),s=r(17),l=r(2),o=r(3),u=r(5),c=r(4),h=r(0),f=(r(12),r(8)),p=r(10),d=(r(14),r(1)),y=r(6),m=(r(9),r(15),r(16),r(21)),b=r(43),v=r(47),x=(r(69),r(34)),g=r(75),j=r(26),w=r(500),O=r(100),k=r(502),_=r(523),T=r(679),R=r(255),M=r(267),I=r(330),P=r(380),C=r(381),S=r(428),U=r(506),A=r(19),B=r(507),z=function(e){var t=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(l.a)(this,r),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.fullExtent=null,e.tileInfo=null,e.datumTransformation=null,e}return Object(o.a)(r,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"fetchPopupFeatures",value:function(){var e=Object(s.a)(n.a.mark((function e(t,r){var i,a,s,l,o,u,c,h,p,d,y,m,b,v,x,j,w;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new A.a("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i})));case 3:if(a=i.popupEnabled,s=Object(B.a)(i,r),a&&Object(f.i)(s)){e.next=6;break}throw new A.a("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:s});case 6:return l=[],e.next=9,i.identify(t);case 9:if(o=e.sent,u=o.value){if(p=u.join(", "),(d={ObjectId:0})[y="Raster.ServicePixelValue"]=this._formatAttributeValue(p,y),(m=null==(c=i.rasterInfo)||null==(h=c.attributeTable)?void 0:h.features)&&m.length>0&&(b=m.filter((function(e){var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===p}))).length>0&&(v=b[0]))for(x in v.attributes)v.attributes.hasOwnProperty(x)&&(j=this._rasterFieldPrefix+x,d[j]=this._formatAttributeValue(v.attributes[x],j));(w=new g.a(this.fullExtent.clone(),null,d)).layer=i,w.sourceLayer=w.layer,l.push(w)}return e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateFullExtent",value:function(){var e,t=this.layer.tileInfo;t&&t.spatialReference||(e=new A.a("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));var r=Object(_.b)(this.layer.fullExtent,this.view.spatialReference,!1),i=Object(_.e)(this.layer.fullExtent,this.view.spatialReference,r);return null==i&&(e=new A.a("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",i),this.datumTransformation||(this.datumTransformation=Object(_.b)(this.layer.fullExtent,this.view.spatialReference,!0)),e?Promise.reject(e):Promise.resolve()}},{key:"_formatAttributeValue",value:function(e,t){if("string"==typeof e){var r,i,a=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,n=this._getFieldInfo(a,t),s=n&&n.format;if(s)return e.trim().indexOf(",")>-1?(i=(r=",")+" ",this._formatDelimitedString(e,r,i,s)):e.trim().indexOf(" ")>-1?(r=i=" ",this._formatDelimitedString(e,r,i,s)):this._formatNumberFromString(e,s)}return e}},{key:"_getFieldInfo",value:function(e,t){if(e&&e.length&&t){var r,i=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_"))&&(r=e,!0)})),r}}},{key:"_formatDelimitedString",value:function(e,t,r,i){var a=this;return e&&t&&r&&i?e.trim().split(t).map((function(e){return a._formatNumberFromString(e,i)})).join(r):e}},{key:"_formatNumberFromString",value:function(e,t){if(!e||!t)return e;var r=Number(e);return isNaN(r)?e:t.format(r)}}]),r}(e);return Object(h.a)([Object(d.b)()],t.prototype,"layer",void 0),Object(h.a)([Object(d.b)()],t.prototype,"view",void 0),Object(h.a)([Object(d.b)()],t.prototype,"fullExtent",void 0),Object(h.a)([Object(d.b)()],t.prototype,"tileInfo",void 0),Object(h.a)([Object(d.b)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(h.a)([Object(y.a)("esri.views.layers.ImageryTileLayerView")],t)},V=r(36),G=r(41),q=r(39),F=r(231),L=r(71),E=r(400),D=r(504),N=r(441),W=r(435),Q=r(190),H=r(252),J=r(305),X=r(442),Z=r(686),K={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"},Y=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(l.a)(this,r),(e=t.call(this))._textureInvalidated=!0,e._memoryUsed=null,e._supportsBilinear=!0,e.stencilRef=0,e.coordScale=[1,1],e._symbolizerParameters=null,e.height=null,e.isRendereredSource=!1,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e.rawPixelData=null,e._suspended=!1,e._bandIds=null,e._interpolation=null,e._transformGrid=null,e.width=null,e.x=0,e.y=0,e.transforms={dvs:Object(H.b)()},e.source=i,e.transformGrid=a,e.interpolation=n,e}return Object(o.a)(r,[{key:"destroy",value:function(){var e=this.getTextures();null==e||e.textures.forEach((function(e){return e.dispose()})),this._rasterTexture=null,this._transformGridTexture=null,this._colormapTexture=null}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||K},set:function(e){this._symbolizerParameters=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._memoryUsed=null)}},{key:"suspended",get:function(){return this._suspended},set:function(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){this._bandIds=e,this.invalidateTexture()}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||"bilinear"!==e&&"cubic"!==e?9728:9729)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}},{key:"setTransform",value:function(e){var t=Object(Q.d)(this.transforms.dvs),r=e.toScreenNoRotation([0,0],this.x,this.y),a=Object(i.a)(r,2),n=a[0],s=a[1],l=this.resolution/this.pixelRatio/e.resolution,o=l*this.width,u=l*this.height,c=Math.PI*this.rotation/180;Object(Q.a)(t,t,Object(J.b)(n,s)),Object(Q.a)(t,t,Object(J.b)(o/2,u/2)),Object(Q.h)(t,t,-c),Object(Q.a)(t,t,Object(J.b)(-o/2,-u/2)),Object(Q.e)(t,t,Object(J.b)(o,u)),Object(Q.f)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"getTextures",value:function(){if(!this._rasterTexture)return null;var e=[],t=[];return this._transformGridTexture&&(t.push(this._transformGridTexture),e.push("u_transformGrid")),this._rasterTexture&&(t.push(this._rasterTexture),e.push("u_image")),this._colormapTexture&&(t.push(this._colormapTexture),e.push("u_colormap")),{names:e,textures:t}}},{key:"getMemoryUsage",value:function(){if(Object(f.h)(this._memoryUsed)){var e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map((function(e){return e.descriptor.width*e.descriptor.height*4})).reduce((function(e,t){return e+t}))}return this._memoryUsed}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}},{key:"updateTexture",value:function(e){var t,r,i,a=e.context;if(!this.stage)return null==(t=this._rasterTexture)||t.dispose(),null==(r=this._transformGridTexture)||r.dispose(),null==(i=this._colormapTexture)||i.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,void(this._colormapTexture=null);if(this._textureInvalidated){this._textureInvalidated=!1;var n=this.source,s=n&&n.pixels&&n.pixels.length>0;this._createOrDestroyRasterTexture(a),this._rasterTexture&&(s?(this._updateColormapTexture(a),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=Object(Z.c)(a,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender())}}},{key:"_createOrDestroyRasterTexture",value:function(e){var t,r,i=this.source?Object(k.h)(this.source,this.bandIds):null;if(i&&i.pixels&&i.pixels.length>0){var a=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(a)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}var n=this.interpolation||"nearest",s=this.isRendereredSource||!(null!=(t=e.capabilities.textureFloat)&&t.textureFloat);this._rasterTexture=Object(Z.b)(e,i,n,s),this._supportsBilinear=null==(r=e.capabilities.textureFloat)?void 0:r.textureFloatLinear,this._rasterTextureBandIds=this.bandIds}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null)}},{key:"_updateColormapTexture",value:function(e){var t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((function(e,r){return e!==t[r]}))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=Object(Z.a)(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Object(Z.a)(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}]),r}(X.a),$=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(e,i,a){var n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(l.a)(this,r),(n=t.call(this,e,i,a)).bitmap=new Y(s,null,null),n.bitmap.coordScale=a,n.bitmap.once("isReady",(function(){return n.ready()})),n}return Object(o.a)(r,[{key:"destroy",value:function(){Object(G.a)(Object(q.a)(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"getMemoryUsage",value:function(){return this.bitmap.getMemoryUsage()}},{key:"setTransform",value:function(e,t){Object(G.a)(Object(q.a)(r.prototype),"setTransform",this).call(this,e,t),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(W.a),ee=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(l.a)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return Object(o.a)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e);return new $(e,t,this._tileInfoView.tileInfo.size)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"bitmap (tile)",brushes:[D.a.raster],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:E.c.MAP});return[].concat(Object(V.a)(Object(G.a)(Object(q.a)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){this.visible&&e.drawPhase===E.c.MAP&&Object(G.a)(Object(q.a)(r.prototype),"doRender",this).call(this,e)}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds(Object(F.e)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,i=Object(L.o)(r.spatialReference);if(i){var a=r.lodAt(e.level).resolution,n=i/a%r.size[0],s=n?(r.size[0]-n)*a:0;t[0]-=s*e.world,t[2]-=s*e.world}}return t}}]),r}(N.a),te=r(429),re=p.a.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),ie=[0,0],ae=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(l.a)(this,r),(e=t.apply(this,arguments))._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._bitmapView=null,e._emptyTilePixelBlock=null,e._srcResolutions=null,e._previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._globalUpdateRequested=!1,e._isCustomTilingScheme=!1,e.useWebGLForProcessing=!0,e._redrawDebounced=Object(m.i)((function(t){return e._redrawImage(t)}),2e3),e}return Object(o.a)(r,[{key:"initialize",value:function(){var e=this.updateFullExtent();this.addResolvingPromise(e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this._bitmapView.removeAllChildren();var r=this._getCacheSize(e);this._tileStrategy=new C.a({cachePolicy:"purge",resampling:!1,acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:r,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.requestUpdate()}}},{key:"hitTest",value:function(e,t){if(this.suspended)return Promise.resolve(null);var r=this.view.toMap(Object(x.b)(e,t));return Promise.resolve(new g.a({attributes:{},geometry:r}))}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,i=t.resolution,a=t.scale,n=this._tileInfoView.getClosestInfoForScale(a);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var l=this._srcResolutions[n.level],o=r.toJSON?r:v.a.fromJSON(r);Object(T.h)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,o,i,l,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this._previousLOD)?void 0:s.level)!==n.level&&(this._previousLOD=n,null!=this._symbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),Object(R.a)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0),this._initializeTileInfo(),this._tileInfoView=new I.a(this.tileInfo,this.fullExtent),this._fetchQueue=new P.a({tileInfoView:this._tileInfoView,concurrency:10,process:function(t,r){return e.fetchTile(t,r)}});var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new C.a({cachePolicy:"purge",resampling:!1,acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:t,tileInfoView:this._tileInfoView}),this._bitmapView=new ee(this._tileInfoView),this._bitmapView.isCustomTilingScheme=this._isCustomTilingScheme,this.container.addChild(this._bitmapView),this.handles.add([Object(j.d)(this,["layer.bandIds","layer.renderer"],(function(){return e._redrawDebounced().catch((function(e){Object(m.m)(e)||re.error(e)}))})),Object(j.d)(this,["layer.interpolation"],(function(t,r){"majority"!==t&&"majority"!==r||!e._canUseMajorityInterpolationOnDataSource()?e._redrawDebounced().catch((function(e){Object(m.m)(e)||re.error(e)})):e.refreshDebounced()})),Object(j.d)(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach"),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,Object(T.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){var e=this;!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=Object(m.d)(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.requestUpdate()}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(U.a)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=Object(s.a)(n.a.mark((function e(){var t=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateRequested||this.suspended||(this.layer.updateRenderer(),this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((function(e){return t._enqueueTileFetch(e)})),this.notifyChange("updating"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this._fetchQueue.length>0||this._globalUpdateRequested}},{key:"acquireTile",value:function(e){var t,r,a,n,s=this._bitmapView.createTile(e),l=s.bitmap;return t=this._tileInfoView.getTileCoords(ie,s.key),r=Object(i.a)(t,2),l.x=r[0],l.y=r[1],l.resolution=this._tileInfoView.getTileResolution(s.key),a=this._tileInfoView.tileInfo.size,n=Object(i.a)(a,2),l.width=n[0],l.height=n[1],this._enqueueTileFetch(s),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,s}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(function(){e.destroy(),t.requestUpdate()})),this.requestUpdate()}},{key:"fetchTile",value:function(e,t){var r=!Object(f.h)(t)&&t.signal,i=this._canUseWebGLForProcessing(),a={tileInfo:this.tileInfo,signal:Object(f.o)(r),registryId:this._blockCacheRegistryId,requestRawData:i,srcResolution:this._srcResolutions[e.level],datumTransformation:this.datumTransformation,interpolation:i?"nearest":this.layer.interpolation};return this.layer.fetchTile(e.level,e.row,e.col,a)}},{key:"_canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.view.spatialReference,t=new b.a({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),r=Object(_.a)(this.layer.rasterInfo,e),i=r.scales,a=r.srcResolutions,n=r.isCustomTilingScheme,s=O.a.create({spatialReference:e,size:512,scales:i});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=n,this._set("tileInfo",s),this._srcResolutions=null!=a?a:[]}},{key:"_enqueueTileFetch",value:function(){var e=Object(s.a)(n.a.mark((function e(t,r){var i,a,s,l,o,u,c,h=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=41;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(i=e.sent,a=this.layer.bandIds,s=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.moving||0!==this._fetchQueue.length){e.next=18;break}return s=!1,e.prev=9,e.next=12,this._redrawImage(this._abortController&&this._abortController.signal);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),Object(m.m)(e.t0)&&re.error(e.t0);case 17:this._globalUpdateRequested=!1;case 18:if((l=this._canUseWebGLForProcessing())&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams(),!i||!i.pixelBlock){e.next=32;break}if(o={extent:i.extent,pixelBlock:i.pixelBlock},t.bitmap.rawPixelData=o,!l){e.next=25;break}t.bitmap.source=i.pixelBlock,t.bitmap.isRendereredSource=!1,e.next=29;break;case 25:return e.next=27,this.layer.applyRenderer(o,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null);case 27:u=e.sent,t.bitmap.source=u,t.bitmap.isRendereredSource=!0;case 29:t.bitmap.symbolizerParameters=l?this._globalSymbolizerParams||this._symbolizerParams:null,l?t.bitmap.transformGrid||(t.bitmap.transformGrid=i.transformGrid):t.bitmap.transformGrid=null,e.next=34;break;case 32:c=this._createEmptyTilePixelBlock(),t.bitmap.source=c,t.bitmap.symbolizerParameters=l?this._symbolizerParams:null,t.bitmap.transformGrid=null;case 34:t.bitmap.bandIds=a,t.bitmap.width=this._tileInfoView.tileInfo.size[0],t.bitmap.height=this._tileInfoView.tileInfo.size[1],t.bitmap.interpolation=this._getLayerInterpolation(),t.bitmap.suspended=s,t.bitmap.invalidateTexture(),t.once("attach",(function(){return h.requestUpdate()})),this._bitmapView.addChild(t),e.next=40;break;case 37:e.prev=37,e.t1=e.catch(1),Object(m.m)(e.t1)||re.error(e.t1);case 40:this.requestUpdate();case 41:case"end":return e.stop()}}),e,this,[[1,37],[9,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var r,i,a=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer.updateRenderer(),!this.hasTilingEffects){e.next=6;break}return e.next=4,this._updateGlobalSymbolizerParams(t);case 4:e.next=7;break;case 6:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 7:return r=this.layer.bandIds,i=this._bitmapView.children.map(function(){var e=Object(s.a)(n.a.mark((function e(t){var i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=a._canUseWebGLForProcessing())||!t.bitmap.rawPixelData){e.next=8;break}return e.next=4,a.layer.applyRenderer(t.bitmap.rawPixelData,a.hasTilingEffects&&a._globalSymbolizerParams&&"stretch"===a._globalSymbolizerParams.type?a._globalSymbolizerParams:null);case 4:t.bitmap.source=e.sent,t.bitmap.isRendereredSource=!0,e.next=9;break;case 8:t.bitmap.isRendereredSource&&t.bitmap.rawPixelData&&(t.bitmap.source=t.bitmap.rawPixelData.pixelBlock),t.bitmap.isRendereredSource=!1;case 9:t.bitmap.symbolizerParameters=i?a._globalSymbolizerParams||a._symbolizerParams:null,t.bitmap.bandIds=r,t.bitmap.interpolation=a._getLayerInterpolation(),t.bitmap.suspended=!1;case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=10,Object(m.j)(i);case 10:this.container.requestRender();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createEmptyTilePixelBlock",value:function(){if(!this._emptyTilePixelBlock){var e=this._tileInfoView.tileInfo.size[0],t=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new w.a({width:e,height:t,pixels:[new Uint8Array(e*t)],mask:new Uint8Array(e*t),pixelType:"u8"})}return this._emptyTilePixelBlock}},{key:"_updateGlobalSymbolizerParams",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var r,i,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,r);case 3:if((i=e.sent)&&i.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:a=this.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(k.h)(i.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this._canUseWebGLForProcessing()&&a&&"stretch"===a.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(a.factor=a.factor.map((function(e){return 255*e})),a.outMin=Math.round(255*a.outMin),a.outMax=Math.round(255*a.outMax)),this._globalSymbolizerParams=a;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=t.url,i=t.rasterInfo,a=t.multidimensionalDefinition,n=t.raster,s=null!=i&&i.multidimensionalInfo?n.getSliceIndex(a):null,l=Object(T.d)(r,s);if(l!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(T.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(T.f)(l,this.layer.raster.rasterInfo),e){var o=this._tileInfoView.getClosestInfoForScale(this.view.scale),u=this._srcResolutions[o.level];Object(T.h)(l,this._blockCacheRegistryId,this.view.extent,this.view.resolution,u,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=l}}},{key:"_canUseMajorityInterpolationOnDataSource",value:function(){var e=this.layer.rasterInfo,t=e.bandCount,r=e.attributeTable,i=e.colormap,a=e.pixelType;return 1===t&&(null!=r||null!=i||"u8"===a||"s8"===a)}},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;return"raster-colormap"===e||"unique-value"===e||"class-breaks"===e?"nearest":this.layer.interpolation}}]),r}(z(Object(M.a)(Object(te.a)(S.a))));Object(h.a)([Object(d.b)()],ae.prototype,"useProgressiveUpdate",null);var ne=ae=Object(h.a)([Object(y.a)("esri.views.2d.layers.ImageryTileLayerView2D")],ae);t.default=ne}}]);
//# sourceMappingURL=21.4aecaa51.chunk.js.map